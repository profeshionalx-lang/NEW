<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grechka ‚Ä¢ –¢—É—Ä–Ω–∏—Ä—ã</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    <style>* { font-family: 'Inter', sans-serif; }</style>
    <script src="/NEW/js/config.js"></script>
    <script type="text/babel" src="/NEW/js/shared.js"></script>
</head>
<body class="bg-black">
    <div id="root"></div>
    <script type="text/babel">
        const { useState } = React;

        function TournamentCard({ tournament: t, canDelete, onDelete }) {
            const status = t.status === 'completed' ? 'completed' : (t.status === 'stage1' || t.status === 'stage2') ? 'active' : 'default';
            return (
                <a href={`/NEW/tournament.html?id=${t.id}`} className="block no-underline">
                    <window.Card className="p-6 cursor-pointer group hover:shadow-xl transition-all h-full relative">
                        <div className="flex justify-between mb-4">
                            <window.Badge variant={status}>{status === 'active' ? 'LIVE' : status === 'completed' ? '–ó–∞–≤–µ—Ä—à–µ–Ω' : '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è'}</window.Badge>
                            {canDelete && <button onClick={(e) => {e.preventDefault(); onDelete(t.id)}} className="text-gray-300 hover:text-red-500 z-10 transition-all opacity-0 group-hover:opacity-100">‚úï</button>}
                        </div>
                        <h3 className="text-2xl font-bold text-black mb-4">{t.name}</h3>
                        <div className="space-y-2 text-sm text-gray-500">
                            {t.date && <div>üìÖ {window.formatDate(t.date)}</div>}
                            {t.location && <div>üìç {t.location}</div>}
                            {t.price && <div>üí∞ {t.price}</div>}
                        </div>
                        <div className="mt-6 pt-6 border-t border-gray-100 flex justify-between items-center">
                            <div className="text-gray-500">
                                <span className="text-2xl font-bold text-black">{t.registeredPlayers?.length || 0}</span> / {t.maxPlayers || '‚àû'}
                            </div>
                            <div className="text-gray-300 group-hover:text-black group-hover:translate-x-1 transition-all">‚Üí</div>
                        </div>
                    </window.Card>
                </a>
            );
        }

        function CreateTournament({ onSubmit, onCancel }) {
            const [form, setForm] = useState({ name: '', date: '', time: '', location: '', price: '', maxPlayers: 16, courts: 2, format: 'fixed' });
            const u = (k, v) => setForm(f => ({ ...f, [k]: v }));
            
            return (
                <div className="max-w-2xl mx-auto">
                    <window.Button variant="ghost" onClick={onCancel} className="mb-8">‚Üê –ù–∞–∑–∞–¥</window.Button>
                    <window.Card className="p-8">
                        <h2 className="text-3xl font-bold text-black mb-8">–ù–æ–≤—ã–π —Ç—É—Ä–Ω–∏—Ä</h2>
                        <div className="space-y-6">
                            <window.Input label="–ù–∞–∑–≤–∞–Ω–∏–µ" value={form.name} onChange={e => u('name', e.target.value)} placeholder="Sunday Cup" />
                            
                            <div>
                                <label className="block text-sm font-medium text-gray-500 mb-3">–§–æ—Ä–º–∞—Ç</label>
                                <div className="grid grid-cols-2 gap-4">
                                    {[['fixed', 'üë´ –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—Ä—ã'], ['rotating', 'üîÑ –°–º–µ–Ω–∞ –ø–∞—Ä—Ç–Ω—ë—Ä–æ–≤']].map(([val, title]) => (
                                        <button key={val} type="button" onClick={() => u('format', val)} className={window.cn('p-4 rounded-2xl border-2 text-left transition-all', form.format === val ? 'border-black bg-black text-white' : 'border-gray-200 bg-white text-gray-700 hover:border-gray-300')}>
                                            <div className="font-semibold">{title}</div>
                                        </button>
                                    ))}
                                </div>
                            </div>

                            <div className="grid grid-cols-2 gap-6">
                                <window.Input label="–î–∞—Ç–∞" type="date" value={form.date} onChange={e => u('date', e.target.value)} />
                                <window.Input label="–í—Ä–µ–º—è" type="time" value={form.time} onChange={e => u('time', e.target.value)} />
                            </div>

                            <window.Input label="–õ–æ–∫–∞—Ü–∏—è" value={form.location} onChange={e => u('location', e.target.value)} placeholder="–ê–¥—Ä–µ—Å –∫–ª—É–±–∞" />

                            <div className="grid grid-cols-3 gap-6">
                                <window.Input label="–¶–µ–Ω–∞" value={form.price} onChange={e => u('price', e.target.value)} placeholder="20 euro" />
                                <div>
                                    <label className="block text-sm font-medium text-gray-500 mb-2">–£—á–∞—Å—Ç–Ω–∏–∫–æ–≤</label>
                                    <select className="w-full p-4 bg-gray-50 border border-gray-200 rounded-2xl text-black" value={form.maxPlayers} onChange={e => u('maxPlayers', +e.target.value)}>
                                        {[8, 12, 16, 24, 32].map(n => <option key={n} value={n}>{n}</option>)}
                                    </select>
                                </div>
                                <window.Input label="–ö–æ—Ä—Ç–æ–≤" type="number" min="1" max="10" value={form.courts} onChange={e => u('courts', +e.target.value)} />
                            </div>

                            <div className="flex gap-4 pt-8">
                                <window.Button onClick={() => onSubmit(form)} disabled={!form.name || !form.date || !form.location} className="flex-1 disabled:opacity-30">–°–æ–∑–¥–∞—Ç—å</window.Button>
                                <window.Button variant="secondary" onClick={onCancel} className="bg-gray-100 text-black hover:bg-gray-200">–û—Ç–º–µ–Ω–∞</window.Button>
                            </div>
                        </div>
                    </window.Card>
                </div>
            );
        }

        function TournamentList() {
            const { user, isAdmin } = window.useAuth();
            const [creating, setCreating] = useState(false);
            const tournaments = window.useCollection('tournaments').filter(t => !t.deleted).sort((a, b) => new Date(a.date || a.createdAt) - new Date(b.date || b.createdAt));
            
            const groups = {
                upcoming: tournaments.filter(t => t.status === 'upcoming'),
                active: tournaments.filter(t => t.status === 'stage1' || t.status === 'stage2'),
                completed: tournaments.filter(t => t.status === 'completed')
            };

            const create = async (data) => {
                const id = 't_' + Date.now();
                await window.fb.doc('tournaments', id).set({ 
                    id, ...data, status: 'upcoming', deleted: false, createdAt: new Date().toISOString(), 
                    createdBy: user?.uid || null, registeredPlayers: [], pairs: [] 
                });
                window.location.href = `/NEW/tournament.html?id=${id}`;
            };

            const del = async (id) => { if(confirm('–£–¥–∞–ª–∏—Ç—å?')) await window.fb.doc('tournaments', id).update({ deleted: true }); };

            const Section = ({ title, items, pulse, dim }) => items.length > 0 && (
                <section>
                    <div className="flex items-center gap-4 mb-6">
                        <div className={window.cn('w-2 h-2 rounded-full', dim ? 'bg-white/30' : 'bg-white', pulse && 'animate-pulse')} />
                        <h3 className={window.cn('text-sm font-medium tracking-widest uppercase', dim ? 'text-white/40' : 'text-white/60')}>{title}</h3>
                    </div>
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        {items.map(t => <TournamentCard key={t.id} tournament={t} onDelete={del} canDelete={user && (user.email === CONFIG.ADMIN_EMAIL || t.createdBy === user.uid)} />)}
                    </div>
                </section>
            );

            if (creating) return <CreateTournament onSubmit={create} onCancel={() => setCreating(false)} />;

            return (
                <div className="space-y-12">
                    <div className="flex justify-end">
                        <window.Button onClick={() => setCreating(true)}>+ –°–æ–∑–¥–∞—Ç—å —Ç—É—Ä–Ω–∏—Ä</window.Button>
                    </div>
                    {groups.upcoming.length === 0 && groups.active.length === 0 ? (
                        <window.Card dark className="p-16 text-center">
                            <div className="text-6xl mb-4 opacity-20">üéæ</div>
                            <p className="text-white/40">–ù–µ—Ç –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö —Ç—É—Ä–Ω–∏—Ä–æ–≤</p>
                        </window.Card>
                    ) : (
                        <>
                            <Section title="–ü–†–ï–î–°–¢–û–Ø–©–ò–ï" items={groups.upcoming} />
                            <Section title="–°–ï–ô–ß–ê–° –ò–ì–†–ê–Æ–¢" items={groups.active} pulse />
                        </>
                    )}
                    <Section title="–ó–ê–í–ï–†–®–Å–ù–ù–´–ï" items={groups.completed} dim />
                </div>
            );
        }

        function App() {
            const auth = window.useAuthState();
            return (
                <window.AuthContext.Provider value={auth}>
                    <window.Layout activePage="tournaments">
                        <TournamentList />
                    </window.Layout>
                </window.AuthContext.Provider>
            );
        }

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
