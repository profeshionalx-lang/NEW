<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grechka ‚Ä¢ –¢—É—Ä–Ω–∏—Ä—ã (Test)</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    <style>* { font-family: 'Inter', sans-serif; }</style>
    <script src="./js/config.js"></script>
    <script type="text/babel" src="./js/shared.js"></script>
</head>
<body class="bg-black">
    <div id="root"></div>
    <script type="text/babel">
        const { useState } = React;

        function TournamentList() {
            const { user, isAdmin } = window.useAuth();
            const [creating, setCreating] = useState(false);
            const tournaments = window.useCollection('tournaments').filter(t => !t.deleted).sort((a, b) => new Date(a.date || a.createdAt) - new Date(b.date || b.createdAt));
            const ready = window.useFirebaseReady();

            // –¢–ï–°–¢: –î–æ–±–∞–≤–ª—è–µ–º –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—É—é –∑–∞–¥–µ—Ä–∂–∫—É 3 —Å–µ–∫—É–Ω–¥—ã
            const [artificialDelay, setArtificialDelay] = useState(true);
            React.useEffect(() => {
                console.log('üîµ TournamentList mounted');
                console.log('üîµ ready:', ready);
                console.log('üîµ artificialDelay:', artificialDelay);
                
                const timer = setTimeout(() => {
                    console.log('üü¢ Artificial delay finished');
                    setArtificialDelay(false);
                }, 3000);
                
                return () => clearTimeout(timer);
            }, [ready]);

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º skeleton –µ—Å–ª–∏ –ª–∏–±–æ Firebase –Ω–µ –≥–æ—Ç–æ–≤, –ª–∏–±–æ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞
            if (!ready || artificialDelay) {
                console.log('üü° Showing skeleton... ready:', ready, 'artificialDelay:', artificialDelay);
                return <window.TournamentsListSkeleton />;
            }

            console.log('üü¢ Showing real content');
            
            const groups = {
                upcoming: tournaments.filter(t => t.status === 'upcoming'),
                active: tournaments.filter(t => t.status === 'stage1' || t.status === 'stage2' || t.status === 'americana'),
                completed: tournaments.filter(t => t.status === 'completed')
            };

            const del = async (id) => { if(confirm('–£–¥–∞–ª–∏—Ç—å?')) await window.fb.doc('tournaments', id).update({ deleted: true }); };

            const Section = ({ title, items, pulse, dim }) => items.length > 0 && (
                <section>
                    <div className="flex items-center gap-4 mb-6">
                        <div className={window.cn('w-2 h-2 rounded-full', dim ? 'bg-white/30' : 'bg-white', pulse && 'animate-pulse')} />
                        <h3 className={window.cn('text-sm font-medium tracking-widest uppercase', dim ? 'text-white/40' : 'text-white/60')}>{title}</h3>
                    </div>
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        {items.map(t => (
                            <div key={t.id} className="bg-white rounded-3xl p-6">
                                <h3 className="text-xl font-bold text-black">{t.name}</h3>
                                <p className="text-gray-500">{t.location}</p>
                            </div>
                        ))}
                    </div>
                </section>
            );

            return (
                <div className="space-y-12">
                    <div className="flex justify-end">
                        <window.Button onClick={() => setCreating(true)}>+ –°–æ–∑–¥–∞—Ç—å —Ç—É—Ä–Ω–∏—Ä</window.Button>
                    </div>
                    {groups.upcoming.length === 0 && groups.active.length === 0 ? (
                        <window.Card dark className="p-16 text-center">
                            <div className="text-6xl mb-4 opacity-20">üéæ</div>
                            <p className="text-white/40">–ù–µ—Ç –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö —Ç—É—Ä–Ω–∏—Ä–æ–≤</p>
                        </window.Card>
                    ) : (
                        <>
                            <Section title="–ü–†–ï–î–°–¢–û–Ø–©–ò–ï" items={groups.upcoming} />
                            <Section title="–°–ï–ô–ß–ê–° –ò–ì–†–ê–Æ–¢" items={groups.active} pulse />
                        </>
                    )}
                    <Section title="–ó–ê–í–ï–†–®–Å–ù–ù–´–ï" items={groups.completed} dim />
                </div>
            );
        }

        function App() {
            const auth = window.useAuthState();
            return (
                <window.AuthContext.Provider value={auth}>
                    <window.Layout activePage="tournaments">
                        <TournamentList />
                    </window.Layout>
                </window.AuthContext.Provider>
            );
        }

        console.log('üöÄ Starting app...');
        console.log('üöÄ window.TournamentsListSkeleton:', typeof window.TournamentsListSkeleton);
        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
